---
title: ì‰½ê²Œ í’€ì–´ ì“´ Spring Security í•„í„°ë§ ë§¤ì»¤ë‹ˆì¦˜
description: ì•Œë©´ ë„ì›€ë˜ëŠ” ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì˜ ë‚´ë¶€ ë™ì‘ ê³¼ì •
image: '/images/series/spring-security/1-basic-concepts/cover.png'
tags:
  - kotlin
  - spring boot
  - spring security
  - servlet
date: 2024-09-23 16:42:42
isFeatured: true
---

> **í•´ë‹¹ ë¬¸ì„œì™€ ê´€ë ¨ëœ ì½”ë“œëŠ” <a style={{color: "grey"}} href="https://github.com/nfl1ryxditimo12/spring-templates/tree/main/spring-security-basic" target="\_blank" rel="noopener noreferrer">ë§í¬</a>ë¥¼ ì°¸ê³ í•´ì£¼ì„¸ìš”.**
>
> **Spring Security ì‹œë¦¬ì¦ˆëŠ” ì•„ë˜ ë²„ì „ì„ ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.**
>
> - jdk: corretto-21
> - spring boot: 3.3.x <a style={{color: "grey"}} href="https://spring.io/projects/spring-boot#support" target="\_blank" rel="noopener noreferrer">[support]</a>
> - spring security: 6.3.x <a style={{color: "grey"}} href="https://spring.io/projects/spring-security#support" target="\_blank" rel="noopener noreferrer">[support]</a>

<br />
<br />

> ## ê¸€ì„ ì‹œì‘í•˜ë©°

Spring Securityì—ì„œ ì¸ì¦, ì¸ê°€ ë“± ë³´ì•ˆ ê´€ë ¨ ê¸°ëŠ¥ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ë‚´ë¶€ì ì¸ ì‘ë™ì´ ì–´ë–»ê²Œ ì´ë¤„ì§ˆê¹Œìš”?

ì´ë²ˆ ê¸€ì—ì„œëŠ” Servlet í™˜ê²½ì„ ê¸°ì¤€ìœ¼ë¡œ í•œ Spring Securityì˜ Filteringì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

**_ì´ ê¸€ì€ ìŠ¤í”„ë§ ë¶€íŠ¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìœ¼ë©°, ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ì˜ ì¼ë¶€ ì„¸ë¶€ ì‚¬í•­ì´ ìƒëµë˜ì–´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤._**

<br />
<br />

## 1. ê°„ë‹¨íˆ ì•Œì•„ë³´ëŠ” ìŠ¤í”„ë§ì˜ HTTP í†µì‹  ê³¼ì •

---

Spring Securityë¥¼ ì„¤ëª…í•˜ê¸° ì•ì„œ, ìŠ¤í”„ë§ì´ HTTP ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ê³¼ì •ì„ ê°„ë‹¨íˆ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

![Servlet êµ¬ì¡°](/images/series/spring-security/1-basic-concepts/servlet-structure.png)<small style={{color:"grey"}}>ì¶œì²˜: https://mangkyu.tistory.com/18</small>

ìŠ¤í”„ë§ì€ HTTP í†µì‹ ì„ ìœ„í•´ ì„œë¸”ë¦¿ì´ë¼ëŠ” ê¸°ìˆ ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. **ì„œë¸”ë¦¿ì€ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œ ì‹œ HTTP í†µì‹ ì„ ë³´ë‹¤ ì‰½ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ê¸°ëŠ¥**ì…ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê°œë°œìëŠ” HTTP ë©”ì„¸ì§€ë¥¼ ì§ì ‘ íŒŒì‹±í•˜ê±°ë‚˜, TCP ì†Œì¼“ì„ ê´€ë¦¬í•˜ëŠ” ë“±ì˜ ìˆ˜ê³ ë¥¼ ëœ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ğŸ˜

ìœ„ ì‚¬ì§„ì˜ Web ContextëŠ” ì„œë¸”ë¦¿ ì˜ì—­ì„ ë‚˜íƒ€ë‚´ë©°, í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì„ ë°›ìœ¼ë©´ `DispatcherServlet`ì´ë¼ëŠ” HTTP ì„œë¸”ë¦¿ì„ ì´ìš©í•´ Spring Contextë¡œ HTTP ìš”ì²­ì„ ì „ë‹¬í•©ë‹ˆë‹¤. ì´í›„ Spring Contextì—ì„œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì²˜ë¦¬í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì‘ë‹µì„ ë‚´ë ¤ì¤ë‹ˆë‹¤.

ë˜í•œ, ìš”ì²­ì´ Spring Contextë¡œ ì „ë‹¬ë˜ê¸° ì „ Filter ë ˆì´ì–´ê°€ ì¡´ì¬í•©ë‹ˆë‹¤. **FilterëŠ” ì„œë¸”ë¦¿ ì˜ì—­ì— í¬í•¨ë˜ì–´ HTTP ìš”ì²­ì˜ ì „ë‹¬ ì „/í›„ë¡œ ê³µí†µëœ ì‘ì—…ì„ ìˆ˜í–‰**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê¸€ì—ì„œ ë‹¤ë£¨ê²Œ ë  Spring Securityê°€ ë™ì‘í•˜ëŠ” ë ˆì´ì–´ì´ê¸°ë„ í•©ë‹ˆë‹¤.

<br />

### ìŠ¤í”„ë§ì´ HTTP ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ìˆœì„œë¥¼ ìš”ì•½í•˜ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

1. í´ë¼ì´ì–¸íŠ¸ê°€ HTTP ìš”ì²­ì„ ì„œë²„ì— ì „ì†¡í•©ë‹ˆë‹¤.
2. ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆ(Servlet Container)ì—ì„œ ìš”ì²­ì„ ì½ì–´ **HttpServletRequest, HttpServletResponse ê°ì²´ë¥¼ ìƒì„±**í•©ë‹ˆë‹¤.
3. Spring Contextì— ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ê¸° ì „, **Servlet FilterChainì„ ì‹¤í–‰**í•©ë‹ˆë‹¤.
   - _FilterChainì€ ì„œë¸”ë¦¿ ì˜ì—­ì˜ Beanìœ¼ë¡œ ë“±ë¡ëœ Filterë“¤ì„ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤._
4. ì´í›„ ìš”ì²­ì„ DispatcherServletìœ¼ë¡œ ì „ë‹¬í•©ë‹ˆë‹¤. **ì´ë•Œë¶€í„° Spring Contextë¡œ ì „í™˜**ë©ë‹ˆë‹¤.
5. DispatcherServletì€ URL ê¸°ë°˜ ë¼ìš°íŒ…ì„ í†µí•´ Controllerë¡œ ìš”ì²­ì„ ì „ë‹¬í•©ë‹ˆë‹¤.
6. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ìˆ˜í–‰ í›„, ìƒì„±ëœ HTTP ì‘ë‹µì„ ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆë¥¼ í†µí•´ í´ë¼ì´ì–¸íŠ¸ë¡œ ì‘ë‹µí•©ë‹ˆë‹¤.

<br />

### ì•Œì•„ë‘ë©´ ì¢‹ì€ ë‚´ìš©

- ì„œë¸”ë¦¿ê³¼ ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆëŠ” HTTP í†µì‹ ì„ ì‰½ê²Œ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ ìŠ¤í”„ë§ì˜ í•µì‹¬ ìš”ì†Œì…ë‹ˆë‹¤. **ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆëŠ” ì„œë¸”ë¦¿ì˜ ìƒëª…ì£¼ê¸°ë¥¼ ê´€ë¦¬í•˜ë©°, HTTP ìš”ì²­ì„ ë°›ì•„ ì„œë¸”ë¦¿ìœ¼ë¡œ ì „ë‹¬**í•©ë‹ˆë‹¤.
- ì„œë¸”ë¦¿ì˜ êµ¬í˜„ì²´ëŠ” HttpServletì´ë©°, ì´ë¥¼ ìƒì†í•œ DispatcherServletì´ë¼ëŠ” ìë°” í´ë˜ìŠ¤ê°€ ì£¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤. **DispatcherServletì€ URL ê¸°ë°˜ ë¼ìš°íŒ…ì„ ì§€ì›í•˜ì—¬ ìš”ì²­ì„ ì ì ˆí•œ Controllerë¡œ ì „ë‹¬**í•©ë‹ˆë‹¤.
- ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆì˜ êµ¬í˜„ì²´ë¡œëŠ” í†°ìº£(Tomcat), ì œí‹°(Jetty) ë“±ì´ ì¡´ì¬í•˜ë©°, **TCP ì†Œì¼“ í†µì‹ ì´ë‚˜ HTTP ë©”ì„¸ì§€ë¥¼ íŒŒì‹±í•˜ì—¬ HttpServletRequest, HttpServletResponse ê°ì²´ë¡œ ë³€í™˜í•˜ëŠ” ê³¼ì •ì„ ë‹´ë‹¹**í•©ë‹ˆë‹¤.

<br />
<br />

## 2. FilterChainì„ ì•Œë©´ ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ê°€ ì‰¬ì›Œì§‘ë‹ˆë‹¤.

---

ì´ì œ `FilterChain`ì´ ë¬´ì—‡ì¸ì§€ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤. **FilterChainì€ ë‹¨ì¼ HTTP ìš”ì²­ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ ë ˆì´ì–´ë¡œ, ì—¬ëŸ¬ê°œì˜ Filterë“¤ì´ ì‚¬ìŠ¬ì²˜ëŸ¼ ì—°ê²°ë˜ì–´ ìˆœì„œì— ë”°ë¼ ë™ê¸°ì ìœ¼ë¡œ ì‘ë™í•˜ëŠ” êµ¬ì¡°**ë¥¼ ê°€ì¡ŒìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì „/í›„ë¡œ ê³µí†µëœ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê±°ë‚˜, ìš”ì²­ì„ ê°€ë¡œì±„ì–´ íŠ¹ì • ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ë“± ë‹¤ì–‘í•œ ìš©ë„ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.

FilterëŠ” Springì˜ `@Order` ì–´ë…¸í…Œì´ì…˜ì´ë‚˜ `Orderd` ì¸í„°í˜ì´ìŠ¤ ë“± ì—¬ëŸ¬ ë°©ë²•ì„ ì´ìš©í•´ FilterChainì˜ ìˆœì„œë¥¼ ì§€ì •í•  ìˆ˜ ìˆìœ¼ë©°, URL íŒ¨í„´ì„ ì´ìš©í•´ íŠ¹ì • ìš”ì²­ì—ë§Œ ì ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

<br />
<br />

## 3. FilterChainì˜ êµ¬ì¡°

---

ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ëŠ” **ì„œë¸”ë¦¿ Filterë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë™ì‘**í•˜ê¸° ë•Œë¬¸ì—, ì¼ë°˜ì ì¸ FilterChainì˜ ê³¼ì •ì„ í•¨ê»˜ ì‚´í´ë³´ë©´ ì´í•´ê°€ ì‰¬ì›Œì§‘ë‹ˆë‹¤. ì•„ë˜ ì´ë¯¸ì§€ëŠ” [ìŠ¤í”„ë§ HTTP í†µì‹  ê³¼ì •](#ìŠ¤í”„ë§ì´-http-ìš”ì²­ì„-ì²˜ë¦¬í•˜ëŠ”-ìˆœì„œë¥¼-ìš”ì•½í•˜ë©´-ë‹¤ìŒê³¼-ê°™ìŠµë‹ˆë‹¤)ì˜ 3ë²ˆì§¸ ë‹¨ê³„ì¸ FilterChainì˜ ì„¸ë¶€ ê³¼ì •ì„ ë‚˜íƒ€ë‚¸ ê²ƒì…ë‹ˆë‹¤.

![FilterChain êµ¬ì¡°](/images/series/spring-security/1-basic-concepts/filterchain.png)<small style={{color:"grey"}}>ì¶œì²˜: https://docs.spring.io/spring-security/reference/servlet/architecture.html</small>

ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆì˜ HTTP ìš”ì²­ ì „ì²˜ë¦¬ ê³¼ì •ì´ ì™„ë£Œëœ í›„ FilterChainì´ ì‹¤í–‰ë©ë‹ˆë‹¤. **FilterChainì€ ë¯¸ë¦¬ ì •ì˜ëœ Filterë“¤ì„ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰**í•˜ë©°, ì¼ë°˜ì ìœ¼ë¡œëŠ” ì¸ì½”ë”©, ë°ì´í„° íŒŒì‹±, ë¡œê¹… ë“± ê°„ë‹¨í•œ ëª©ì ì„ ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤.

ì—¬ê¸°ì„œ ëˆˆì—¬ê²¨ë³¼ ì ì€ DelegatingFilterProxyë¼ëŠ” Filterì…ë‹ˆë‹¤. ì´ëŠ” **ì„œë¸”ë¦¿ê³¼ ìŠ¤í”„ë§ì˜ ìƒëª…ì£¼ê¸° ì°¨ì´ë¡œ ì¸í•œ ë¬¸ì œë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•œ ì¥ì¹˜**ë¡œ, DelegatingFilterProxyê°€ í˜¸ì¶œë˜ëŠ” ì‹œì ì— ìŠ¤í”„ë§ Beanì— ë“±ë¡ëœ Filter êµ¬í˜„ì²´ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ **Lazy Loading ì „ëµìœ¼ë¡œ ìŠ¤í”„ë§ Beanì— ì•ˆì „í•œ ì ‘ê·¼**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
<span style={{color: "grey"}}>_ìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” ìƒëª…ì£¼ê¸° ì œì–´ê°€ ê°€ëŠ¥í•˜ì—¬, ì„œë¸”ë¦¿ ì˜ì—­ì—ì„œ í”„ë¡ì‹œ íŒ¨í„´ì„ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ìŠ¤í”„ë§ Bean ì ‘ê·¼ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤._</span>

ì•„ë˜ `Pseudo Code`ëŠ” **DelegatingFilterProxyì˜ í˜¸ì¶œ ì‹œì  ì¼ë¶€**ë¥¼ ë‚˜íƒ€ë‚¸ ì½”ë“œì…ë‹ˆë‹¤.

```java
/* DelegatingFilterProxy.java */

protected Filter initDelegate(WebApplicationContext wac) throws ServletException {
    // ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì˜ ê²½ìš°, targetBeanNameì€ `securityFilterChain`
    String targetBeanName = this.getTargetBeanName();

    // targetBeanNameê³¼ ì¼ì¹˜í•˜ëŠ” ì´ë¦„ì„ ê°€ì§„ Filter Beanì„ ì°¾ìŒ
    Filter delegate = (Filter)wac.getBean(targetBeanName, Filter.class);

    // ë°˜í™˜ ì´í›„ `delegate.doFilter()`ë¥¼ í†µí•´ Filter êµ¬í˜„ì²´ë¥¼ ì‹¤í–‰
    return delegate
}
```

ì´ë¥¼ í†µí•´ ì˜ì¡´ì„± ì£¼ì…(DI)ê³¼ ê°™ì€ ìŠ¤í”„ë§ì˜ ê¸°ìˆ ì„ ì‚¬ìš©í•  ìˆ˜ ìˆì–´, **ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ëŠ” ìœ ì—°í•˜ê³  í™•ì¥ì„±ìˆëŠ” ë³´ì•ˆ ì„¤ì •ì´ ê°€ëŠ¥**í•˜ë©° ë‹¤ì–‘í•œ ì„œë¹„ìŠ¤ ìš”êµ¬ ì‚¬í•­ì„ ì¶©ì¡±ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<br />
<br />

## 4. Spring Securityì˜ FilterChain

---

![SecurityFilterChain](/images/series/spring-security/1-basic-concepts/securityfilterchain.png)<small style={{color:"grey"}}>ì¶œì²˜: https://docs.spring.io/spring-security/reference/servlet/architecture.html</small>

DelegatingFilterProxyì˜ êµ¬í˜„ì²´ë¥¼ ë³´ë©´ SecurityFilterChainì´ ì•„ë‹Œ FilterChainProxyë¡œ ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” **ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì˜ ì‹œì‘ì ì´ FilterChainProxyë¼ëŠ” ì ì„ ì˜ë¯¸**í•˜ê¸°ë„ í•©ë‹ˆë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ë¥¼ ì ìš©í•˜ë‹¤ ë¬¸ì œë¥¼ ê²ªëŠ”ë‹¤ë©´, FilterChainProxyë¥¼ ë””ë²„ê¹… í¬ì¸íŠ¸ë¡œ ì¶”ê°€í•´ ë³´ëŠ” ê²ƒë„ ì¢‹ì€ ë°©ë²•ì…ë‹ˆë‹¤.

**FilterChainProxyëŠ” ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì˜ í•µì‹¬ ì—­í• ì„ ë‹´ë‹¹í•˜ë©°, ë‹¤ìŒê³¼ ê°™ì€ ì£¼ìš” ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.**
- ìš”êµ¬ ì‚¬í•­ì— ë§ëŠ” SecurityFilterChain ì„ íƒ
- SecurityContext ì´ˆê¸°í™”ë¡œ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€
- StrictHttpFirewallì„ ì´ìš©í•œ ë°©í™”ë²½ ìƒì„±

ê³µí†µëœ ì‘ì—…ì„ ì²˜ë¦¬í•œ í›„, FilterChainProxyëŠ” ë³´ì•ˆ ì‘ì—…ì„ ìœ„í•´ SecurityFilterChainì„ í˜¸ì¶œí•˜ì—¬ ê°œë°œìê°€ ì§€ì •í•œ ë³´ì•ˆ Filterë“¤ì„ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤.

<br />

<details>
<summary style={{fontWeight: "bold", fontSize: "large"}}>ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì˜ ë³´ì•ˆ Filter ì‹¤í–‰ ìˆœì„œ</summary>

- ChannelProcessingFilter
- ConcurrentSessionFilter
- WebAsyncManagerIntegrationFilter
- SecurityContextPersistenceFilter
- HeaderWriterFilter
- CorsFilter
- CsrfFilter
- LogoutFilter
- OAuth2AuthorizationRequestRedirectFilter
- Saml2WebSsoAuthenticationRequestFilter
- X509AuthenticationFilter
- AbstractPreAuthenticatedProcessingFilter
- CasAuthenticationFilter
- OAuth2LoginAuthenticationFilter
- Saml2WebSsoAuthenticationFilter
- UsernamePasswordAuthenticationFilter
- ConcurrentSessionFilter
- OpenIDAuthenticationFilter
- DefaultLoginPageGeneratingFilter
- DefaultLogoutPageGeneratingFilter
- DigestAuthenticationFilter
- BearerTokenAuthenticationFilter
- BasicAuthenticationFilter
- RequestCacheAwareFilter
- SecurityContextHolderAwareRequestFilter
- JaasApiIntegrationFilter
- RememberMeAuthenticationFilter
- AnonymousAuthenticationFilter
- OAuth2AuthorizationCodeGrantFilter
- SessionManagementFilter
- ExceptionTranslationFilter
- FilterSecurityInterceptor
- SwitchUserFilter
</details>

<br />
<br />

## 5. ë‹¤ì¤‘ SecurityFilterChain

---

ì„œë¹„ìŠ¤ ìš”êµ¬ ì‚¬í•­ ë³„ ë³´ì•ˆ ì¡°ì¹˜ë¥¼ ë‹¬ë¦¬ í•´ì•¼í•  ê²½ìš°ë„ ìˆëŠ”ë°, ì•„ë˜ ì‚¬ì§„ê³¼ ê°™ì´ FilterChainProxyë¥¼ ì´ìš©í•´ URL ë³„ë¡œ ë¡œì§ì„ ë¶„ë¦¬í•˜ì—¬ ì„œë¡œ ë‹¤ë¥¸ ë³´ì•ˆ Filterë¥¼ ë™ì‘ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![Multi-SecurityFilterChain](/images/series/spring-security/1-basic-concepts/multi-securityfilterchain.png)<small style={{color:"grey"}}>ì¶œì²˜: https://docs.spring.io/spring-security/reference/servlet/architecture.html</small>

ì•„ë˜ `Pseudo Code`ëŠ” **FilterChainProxyì—ì„œ SecurityFilterChainì„ í˜¸ì¶œí•˜ëŠ” ê³¼ì •**ì„ ë‚˜íƒ€ë‚¸ ì½”ë“œì…ë‹ˆë‹¤.

```java
/* FilterChainProxy.java */

private void doFilterInternal(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
    // ë°©í™”ë²½ ì„¤ì •í•˜ëŠ” ë‹¨ê³„ë¡œ Method, URL, IP ë“±ì´ ì ì ˆí•œì§€ ê²€ì‚¬
    FirewalledRequest firewallRequest = this.firewall.getFirewalledRequest((HttpServletRequest)request);

    // RequestMatcherë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¡°ê±´ì— ë§ëŠ” SecurityFilterChainë¥¼ ê°€ì ¸ì˜´
    List<Filter> filters = this.getFilters((HttpServletRequest)firewallRequest);
    
    // ì•„ë˜ VirtualFilterChainì´ ëª¨ë‘ ì™„ë£Œëœ í›„ ì‹¤í–‰ë˜ëŠ” ì½œë°±
    // ê¸°ì¡´ ì„œë¸”ë¦¿ FilterChainìœ¼ë¡œ ëŒì•„ê°€ê¸° ìœ„í•œ ì¥ì¹˜
    FilterChain reset = (req, res) -> {
        firewallRequest.reset();
        chain.doFilter(req, res);
    };

    // ë‹¨ìˆœ Filter ë¦¬ìŠ¤íŠ¸ë¥¼ FilterChainìœ¼ë¡œ ë³€í™˜í•´ì£¼ëŠ” ë‹¨ê³„
    VirtualFilterChain filterChain = this.filterChainDecorator.decorate(reset, filters);

    // Security Filterë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ìˆ˜í–‰í•¨
    filterChain.doFilter(firewallRequest, firewallResponse);
}
```

**ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì˜ FilterChainProxyëŠ” RequestMatcherë¥¼ ì´ìš©í•´ ì–´ë–¤ SecurityFilterChainì„ ì‚¬ìš©í• ì§€ ê²°ì •í•˜ëŠ” ìœ ì—°ì„±**ì„ ê°–ì¶”ê³  ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê³µí†µ ì‘ì—…ì€ FilterChainProxyë¡œ ìœ„ì„í•˜ë©°, ì¡°ê±´ë³„ ì‘ì—…ì€ ë¡œì§ì„ ë‹¬ë¦¬ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì‚¬ì „ ì •ì˜í•œ SecurityConfig í´ë˜ìŠ¤ì—ì„œ ì•„ë˜ì™€ ê°™ì´ FilterChainì„ ë“±ë¡í•˜ë©´ ë‹¤ì¤‘ SecurityFilterChainì„ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```kotlin
/* SecurityConfig.kt */

@Configuration
@EnableWebSecurity
class SecurityConfig {
    /* USER, ADMIN ì‚¬ìš©ì ìƒì„± */
    @Bean
    fun userDetailService(): UserDetailsService {
        val user: User.UserBuilder = User.builder().passwordEncoder { "{noop}$it" }
        val manager = InMemoryUserDetailsManager()
        manager.createUser(user.username("user").password("password").roles("USER").build())
        manager.createUser(user.username("admin").password("password").roles("USER", "ADMIN").build())
        return manager
    }

    /*
        '/admin' ê²½ë¡œë¡œ ì ‘ê·¼ ì‹œ í•´ë‹¹ FilterChainì„ ì‚¬ìš©í•˜ê²Œ ë¨
        'ROLE_ADMIN' ê¶Œí•œì´ ì—†ìœ¼ë©´ 403 Forbidden ë°œìƒ
    */
    @Bean
    @Order(1)
    fun adminFilterChain(http: HttpSecurity): SecurityFilterChain {
        http.securityMatcher("/admin")
        http.authorizeHttpRequests { it.anyRequest().hasRole("ADMIN") }
        http.httpBasic { }

        return http.build()
    }

    /*
        ì´ ì™¸ì˜ URLë¡œ ì ‘ê·¼í•˜ë©´ í•´ë‹¹ FilterChainì„ ì‚¬ìš©í•˜ê²Œ ë¨
        @Order ì–´ë…¸í…Œì´ì…˜ì´ ì—†ìœ¼ë©´ í›„ìˆœìœ„ë¡œ ë™ì‘í•¨
    */
    @Bean
    fun defaultFilterChain(http: HttpSecurity): SecurityFilterChain {
        http.authorizeHttpRequests { it.anyRequest().authenticated() }
        http.formLogin { }

        return http.build()
    }
}
```

**FilterChainProxyì—ì„œ securityMatcherë¥¼ ê¸°ì¤€ìœ¼ë¡œ SecurityFilterChainì„ ê²°ì •**í•˜ê²Œ ë©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì„œë¹„ìŠ¤ ìš”êµ¬ ì‚¬í•­ì— ë”°ë¼ ë³´ì•ˆ Filter êµ¬ì„±ì„ ë‹¬ë¦¬ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ìœ„ ì½”ë“œì—ì„œ êµ¬ì„±ëœ SecurityFilterChainì€ ì•„ë˜ `Pseudo Code`ì™€ ê°™ì´ FilterChainProxyì—ì„œ ì„ íƒë©ë‹ˆë‹¤.

```java
/* FilterChainProxy.java */

private List<Filter> getFilters(HttpServletRequest request) {
    Iterator iter = this.filterChains.iterator();
    SecurityFilterChain chain;

    do {
        if (!iter.hasNext()) {
            return null;
        }

        chain = (SecurityFilterChain) iter.next();

        /*
            ë°˜ë³µë¬¸ì„ ëŒë©° RequestMatcherë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¡°ê±´ì— ë§ëŠ” FilterChainì„ ì„ íƒí•©ë‹ˆë‹¤.
            URL, Request Header ë“± ë‹¤ì–‘í•œ ì¡°ê±´ì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        */
    } while (!chain.matches(request));

    return chain.getFilters();
}
```
![console](/images/series/spring-security/1-basic-concepts/debug.png)

<br />
<br />

## 6. ë™ì‘ êµ¬ì¡° ìš”ì•½

---

1. **DelegatingFilterProxyê°€ í˜¸ì¶œë˜ë©´ WebApplicationContextë¥¼ ì°¸ì¡°í•´ Filter êµ¬í˜„ì²´ì¸ FilterChainProxyë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.**
   - _NullPointerExceptionì„ ë°©ì§€í•˜ê¸° ìœ„í•´ WebApplicationContextê°€ ì¤€ë¹„ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦½ë‹ˆë‹¤._
   - _ë‚´ë¶€ì ìœ¼ë¡œ DelegatingFilterProxy -> WebMvcSecurityConfiguration -> CompositeFilter -> FilterChainProxy ìˆœì˜ ë™ì‘ ê³¼ì •ì´ ì¡´ì¬í•©ë‹ˆë‹¤._
2. **FilterChainProxyëŠ” ìš”ì²­ ì¡°ê±´ì— ë”°ë¼ ì ì ˆí•œ SecurityFilterChainì„ ì„ íƒí•˜ê³  í˜¸ì¶œí•©ë‹ˆë‹¤.**
   - _RequestMatcherë¥¼ ì´ìš©í•´ ë¯¸ë¦¬ ì§€ì •í•œ ì¡°ê±´ì„ ë”°ë¦…ë‹ˆë‹¤._
3. **ì„ íƒëœ SecurityFilterChain ë‚´ì˜ ë³´ì•ˆ Filterë“¤ì„ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤.**
4. **ëª¨ë“  Filterë¥¼ í†µê³¼í•˜ë©´ DispatcherServletìœ¼ë¡œ ìš”ì²­ì„ ì „ë‹¬í•˜ë©°, ìŠ¤í”„ë§ ì‹œíë¦¬í‹° í•„í„°ë§ ê³¼ì •ì´ ì¢…ë£Œë©ë‹ˆë‹¤.**
   - _ì´í›„ì—ë„ SecurityContextHolderë¥¼ í†µí•´ ì¸ì¦ ë° ì¸ê°€ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤._

<br />
<br />

## ğŸ“š ì°¸ê³ í•˜ë©´ ì¢‹ì€ ìë£Œ
---

- [Spring Security ê³µì‹ ë¬¸ì„œ](https://docs.spring.io/spring-security/reference/servlet/index.html)
- [Servlet Security, The Big Picture - í† ë¦¬ë§˜ì˜ í•œê¸€ë¼ì´ì¦ˆ í”„ë¡œì íŠ¸](https://godekdls.github.io/Spring%20Security/servletsecuritythebigpicture)
- [í•„í„°(Filter)ê°€ ìŠ¤í”„ë§ ë¹ˆ ë“±ë¡ê³¼ ì£¼ì…ì´ ê°€ëŠ¥í•œ ì´ìœ (DelegatingFilterProxyì˜ ë“±ì¥)](https://mangkyu.tistory.com/221)

<br />